# 動的スピーカー管理機能実装

## 解決したいこと

現在のスピーカーセレクターは固定で A-E の 5 人のスピーカーに限定しようと思っていたが、実際に使ってみるといろんな speaker を登場させるニーズがあった

## 方針

- 最初は A のみ表示し、必要に応じて動的にスピーカーを追加する方式にすれば、より直感的で柔軟な UI になる
- "New Speaker"オプションを通じてスピーカーを追加することで、必要な分だけスピーカーを管理できる

## やったこと

1. `data-manager.ts`を読み込み、現在の固定 5 人のスピーカー管理構造を確認
2. `speaker-selector.ts`を読み込み、現在のセレクター実装を確認
3. `post-form.ts`を読み込み、スピーカーセレクターとの連携方法を確認
4. 動的スピーカー管理の実装計画を策定
5. DataManager クラスを修正：最初は A のみ、動的追加機能を実装
   - `addNextSpeaker()` と `getNextAvailableSpeakerId()` メソッドを追加
6. SpeakerSelector クラスを修正：New Speaker オプションと動的追加ロジックを実装
   - コンストラクタに `onNewSpeaker` コールバック追加
   - "New Speaker" オプションの表示と選択ハンドリング実装
   - 新しいスピーカー追加時に自動選択される機能を実装
7. PostForm クラスを修正：新しいスピーカー追加処理を実装
   - `handleNewSpeaker()` と `setSpeakerValue()` メソッド追加
8. ChatLogMakerView クラスを修正：全体の統合処理を実装
9. リプライフォームで NEW_SPEAKER が表示される問題を修正
   - MessageRenderer と PostForm での型定義統一
   - コールバック関数が適切に Speaker オブジェクトを返すように修正
   - 新しいスピーカー追加時に適切にセレクターの値が更新されるように修正
10. リプライフォームで New Speaker 選択時にモーダルが閉じる問題を修正
    - MessageRenderer にリプライフォーム状態保持機能を追加
    - 新しいスピーカー追加後にリプライフォームを自動再表示
    - 入力中のメッセージ内容を保持・復元する機能を実装
    - フォーム完了時・キャンセル時に状態をクリアする処理を追加

## TODO

- 実装完了、テストが必要
