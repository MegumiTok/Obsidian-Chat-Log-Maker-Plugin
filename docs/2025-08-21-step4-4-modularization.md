# Chat Log Maker Plugin 開発 - Step 4-4: コードのモジュール化

## 概要

現在すべての機能が一枚の view.ts ファイルにまとまっており、メンテナンスが困難な状況。各機能をモジュール化してファイルを分割し、保守性を向上させる。

## 問題点

- view.ts が 980 行を超える巨大ファイル
- UI 関連、データ管理、イベント処理が混在
- どこにどのデザインや機能が書かれているかわかりにくい
- 機能追加・修正時の影響範囲が不明

## 仮説

- ファイルを責務ごとに分割することで可読性向上
- コンポーネント化により再利用性向上
- 型定義の分離により型安全性向上

## やること

1. 型定義の分離 (types.ts)
2. データ管理クラスの分離 (data-manager.ts)
3. UI コンポーネントの分離
   - message-renderer.ts (メッセージ表示)
   - post-form.ts (投稿フォーム)
   - speaker-selector.ts (話者選択)
4. ユーティリティ関数の分離 (utils.ts)
5. メインビューの簡潔化

## やったこと

1. **型定義ファイルの分離** (src/types.ts)

   - Speaker、Comment インターフェースを分離
   - CHAT_LOG_MAKER_VIEW_TYPE 定数を分離

2. **データ管理クラスの作成** (src/data-manager.ts)

   - DataManager クラスで Speaker とコメントの状態管理を統一
   - CRUD 操作、Markdown 生成機能を集約
   - 固定 5 人の Speaker 初期化処理を内包

3. **UI コンポーネントの分離**

   - **SpeakerSelector** (src/speaker-selector.ts): Speaker 選択ドロップダウンの管理
   - **PostForm** (src/post-form.ts): 投稿フォームの作成と投稿処理
   - **MessageRenderer** (src/message-renderer.ts): メッセージ表示、編集、返信機能

4. **メインビューの簡潔化** (view.ts)

   - 980 行 → 約 180 行に大幅削減
   - 各コンポーネントとの連携に集中
   - イベント処理の簡潔化

5. **ファイル構成の改善**
   - 元の view.ts を view-old.ts にバックアップ
     - 削除済み
   - src/ディレクトリにモジュールを整理

## 効果

- **保守性向上**: 各機能が独立したファイルに分離
- **可読性向上**: 責務が明確に分かれている
- **再利用性向上**: コンポーネントとして独立利用可能
- **テスト容易性**: 各クラスが独立してテスト可能
