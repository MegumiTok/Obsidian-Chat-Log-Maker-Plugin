# Chat Log Maker Plugin 開発 - Step 3: 機能実装

## 概要

Step2 で完成した縦 1 カラムレイアウトに、実際のチャット機能を実装する。Markdown パーサー、UI 編集機能、返信機能など、docs/mockup-v2.html で示された全ての機能を実装する。

## 優先順位（UI ファースト方針）

### Phase 1: UI 基本操作（最優先）

1. **登場人物の動的管理（実際のチャットとの連携）**

   - メッセージ追加時の話者選択（セレクトボックス）
   - 新規話者の追加機能
   - 話者名の変更・削除
   - 話者とメッセージの連携

2. **UI 側からのチャット編集（インライン編集）**

   - メッセージクリックで編集モード
   - テキストエリアでの直接編集
   - 保存・キャンセル機能

3. **UI 側からの返信機能**
   - 返信ボタンの実装
   - 返信フォームの表示（話者選択含む）
   - ネストレベルの管理

### Phase 2: 視覚化（中優先）

4. **返信構造の視覚化（ネスト表示）**
   - インデント表示
   - 返信線の表示
   - 階層の分かりやすい表現

### Phase 3: 永続化（低優先）

5. **Markdown の chat コードブロック認識・解析**

   - 保存された Markdown から UI への復元
   - 初期データの読み込み

## 実装方針

### UI ファースト・手動操作重視

- **基本フロー**: 話者選択 → メッセージ入力 → 投稿 → 表示
- **mockup-v1.html 参考機能**:
  - 投稿フォームでの話者選択（セレクトボックス）
  - 返信時の話者選択機能
  - リアルタイムなメッセージ表示更新
- **mockup-v2.html 参考デザイン**:
  - 縦 1 カラムレイアウト
  - 登場人物セクション（150px 固定）
  - チャット表示エリア（可変高さ）

### シンプル設計原則

- **複雑な同期機能より確実に動く基本機能**
- **段階的拡張**: 基本機能 → 視覚化 → 永続化
- **バックアップ重視**: Markdown は「保存形式」として位置づけ
- **リロード許容**: 双方向同期は理想だが、最悪リロードで復元できれば OK

### 具体的な実装ポイント

#### 1. 投稿フォーム実装 (mockup-v1.html 参考)

- 話者選択セレクトボックス
- メッセージ入力テキストエリア
- 投稿ボタン
- 返信モード時の親メッセージ表示

#### 2. メッセージ管理

- メッセージ配列への追加・削除・編集
- 話者ラベル（A, B, C...）の自動割り当て
- ネストレベルの管理

#### 3. 登場人物管理

- 動的な話者追加・削除
- 話者名とラベルのマッピング
- 未使用話者の自動非表示
